<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
  <style>
    body { direction: rtl; }
    .time-btn { margin: 2px; }
    .active-time { background-color: #198754; color: white; }
  </style>
</head>
<body>
  <div class="container my-4">
    <h2 class="mb-4">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø°</h2>
    <form id="editForm">
      <div class="mb-3"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°</label><input type="text" class="form-control" id="name" required></div>
      <div class="mb-3"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="text" class="form-control" id="phone" required></div>
      <div class="mb-3"><label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶</label>
        <select class="form-select" id="offer" required>
          <option value="15">15 Ø³Ø§Ø¹Ø©</option>
          <option value="50">50 Ø³Ø§Ø¹Ø©</option>
          <option value="100">100 Ø³Ø§Ø¹Ø©</option>
        </select>
      </div>
      <div class="mb-3"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</label><input type="date" class="form-control" id="startDate" required></div>
      <div class="mb-3"><label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label><input type="number" class="form-control" id="amountPaid" required></div>
      <div class="mb-3"><label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label><input type="number" class="form-control" id="totalAmount" required></div>
      <div class="mb-3"><label class="form-label">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</label><input type="number" class="form-control" id="remainingHours" required></div>

      <div class="mb-3">
        <label class="form-label">ğŸ• Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</label>
        <div id="availability-container"></div>
      </div>

      <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
      <a href="all-teachers.html" class="btn btn-secondary">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
    </form>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAHf3U8lU8aoGv4YYUZ57iPvRHirSwNkew",
      projectId: "noon-a0b62"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const urlParams = new URLSearchParams(window.location.search);
    const teacherId = urlParams.get("id");

    const days = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
    const sessionTimes = [
      "08:00 - 10:00", "10:00 - 12:00", "12:00 - 14:00",
      "14:00 - 16:00", "16:00 - 18:00", "18:00 - 20:00", "20:00 - 22:00"
    ];
    let availability = {};

    const container = document.getElementById("availability-container");

    function renderAvailability() {
      container.innerHTML = "";
      days.forEach(day => {
        const dayRow = document.createElement("div");
        dayRow.innerHTML = `<strong>${day}</strong><br>`;
        sessionTimes.forEach(time => {
          const btn = document.createElement("button");
          btn.className = "btn btn-sm time-btn " + (availability[day]?.includes(time) ? "active-time" : "btn-outline-secondary");
          btn.textContent = time;
          btn.onclick = () => {
            availability[day] = availability[day] || [];
            if (availability[day].includes(time)) {
              availability[day] = availability[day].filter(t => t !== time);
            } else {
              availability[day].push(time);
            }
            renderAvailability();
          };
          dayRow.appendChild(btn);
        });
        container.appendChild(dayRow);
      });
    }

    async function loadTeacher() {
      const doc = await db.collection("teachers").doc(teacherId).get();
      if (!doc.exists) {
        alert("âŒ Ø§Ù„Ø£Ø³ØªØ§Ø° ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");
        window.location.href = "all-teachers.html";
        return;
      }
      const t = doc.data();
      document.getElementById("name").value = t.name;
      document.getElementById("phone").value = t.phone;
      document.getElementById("offer").value = t.offer;
      document.getElementById("startDate").value = t.startDate;
      document.getElementById("amountPaid").value = t.amountPaid;
      document.getElementById("totalAmount").value = t.totalAmount;
      document.getElementById("remainingHours").value = t.remainingHours;
      availability = t.availability || {};
      renderAvailability();
    }

    document.getElementById("editForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      await db.collection("teachers").doc(teacherId).update({
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        offer: document.getElementById("offer").value,
        startDate: document.getElementById("startDate").value,
        amountPaid: parseFloat(document.getElementById("amountPaid").value),
        totalAmount: parseFloat(document.getElementById("totalAmount").value),
        remainingHours: parseFloat(document.getElementById("remainingHours").value),
        availability: availability
      });
      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
      window.location.href = "all-teachers.html";
    });

    loadTeacher();
  </script>
</body>
</html>
