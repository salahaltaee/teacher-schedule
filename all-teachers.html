<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ÙƒÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
  <style>
    body { direction: rtl; }
    .teacher-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
    .status-green { color: green; font-weight: bold; }
    .status-yellow { color: orange; font-weight: bold; }
    .status-red { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="mb-4">ğŸ“š Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h1>
    <div id="teachersList"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAHf3U8lU8aoGv4YYUZ57iPvRHirSwNkew",
      projectId: "noon-a0b62"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function getStatusColor(remaining, total) {
      const remainingSessions = Math.floor(remaining / 1.5);
      if (remainingSessions === 0) return "ğŸ”´ Ù…Ù†ØªÙ‡ÙŠ";
      if (remainingSessions <= 3) return "ğŸŸ¡ Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡";
      return "ğŸŸ¢ Ù†Ø´Ø·";
    }

    function calculateDaysSince(dateStr) {
      const start = new Date(dateStr);
      const now = new Date();
      const diff = Math.floor((now - start) / (1000 * 60 * 60 * 24));
      return diff;
    }

    db.collection("teachers").get().then(snapshot => {
      let html = "";
      snapshot.forEach(doc => {
        const t = doc.data();
        const status = getStatusColor(t.remainingHours, parseInt(t.offer));
        const done = Math.floor((parseInt(t.offer) - t.remainingHours) / 1.5);
        const left = Math.floor(t.remainingHours / 1.5);
        const daysSince = calculateDaysSince(t.startDate);
        html += `
          <div class="teacher-card">
            <h5>${t.name} - ${t.offer} Ø³Ø§Ø¹Ø©</h5>
            <p>Ù‡Ø§ØªÙ: ${t.phone} | Ø¨Ø¯Ø£: ${t.startDate}</p>
            <p>Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${t.amountPaid} / ${t.totalAmount}</p>
            <p>ğŸ’¼ Ø§Ù„Ø­Ø§Ù„Ø©: ${status}</p>
            <p>ğŸ“Š Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©: ${done} | Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${left} | Ù…Ù†Ø° Ø§Ù„Ø¨Ø¯Ø¡: ${daysSince} ÙŠÙˆÙ…</p>
            <a href="details.html?id=${doc.id}" class="btn btn-primary btn-sm">ğŸ“„ ØªÙØ§ØµÙŠÙ„</a>
            <a href="edit-teacher.html?id=${doc.id}" class="btn btn-warning btn-sm">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
            <button onclick="deleteTeacher('${doc.id}')" class="btn btn-danger btn-sm">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            <a href="https://wa.me/${t.phone}?text=Ù…Ø±Ø­Ø¨Ø§ Ø§Ø³ØªØ§Ø° ${encodeURIComponent(t.name)} Ø§Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ø¦Ù„Ø© Ù†ÙˆÙ†" target="_blank" class="btn btn-success btn-sm">ğŸ“© ØªØ±Ø­ÙŠØ¨</a>
            <button onclick="decreaseHour('${doc.id}', ${t.remainingHours})" class="btn btn-outline-danger btn-sm">â– Ø¬Ù„Ø³Ø© (1.5 Ø³Ø§Ø¹Ø©)</button>
          </div>
        `;
      });
      document.getElementById("teachersList").innerHTML = html;
    });

    function deleteTeacher(id) {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ")) {
        db.collection("teachers").doc(id).delete().then(() => location.reload());
      }
    }

    function decreaseHour(id, hours) {
      const newHours = Math.max(0, hours - 1.5);
      db.collection("teachers").doc(id).update({ remainingHours: newHours }).then(() => location.reload());
    }
  </script>
</body>
</html>
